#include "test.h"
#include "../src/req.h"

void test_req() {
  Req r;
  announce("its_fine_with_extras", 2 == req_parse("<2,4> hello", &r)->segment);

  announce("errors_on_empty", req_parse("", &r)->error);
  announce("errors_on_no_num", req_parse("<,>", &r)->error);
  announce("errors_on_letter", req_parse("<2a,4>", &r)->error);
  announce("parses_segment", 2 == req_parse("<2,4>", &r)->segment);
  announce("errors_on_long", req_parse(
        "<"
        "22222222222222222222222222222222222222222222222222"
        "22222222222222222222222222222222222222222222222222"
        "22222222222222222222222222222222222222222222222222"
        "22222222222222222222222222222222222222222222222222"

        "22222222222222222222222222222222222222222222222222"
        "22222222222222222222222222222222222222222222222222"
        "22222222222222222222222222222222222222222222222222"
        "22222222222222222222222222222222222222222222222222"

        "22222222222222222222222222222222222222222222222222"
        "22222222222222222222222222222222222222222222222222"
        "22222222222222222222222222222222222222222222222222"
        "22222222222222222222222222222222222222222222222222"

        "22222222222222222222222222222222222222222222222222"
        "22222222222222222222222222222222222222222222222222"
        "22222222222222222222222222222222222222222222222222"
        "22222222222222222222222222222222222222222222222222"

        "22222222222222222222222222222222222222222222222222"
        "22222222222222222222222222222222222222222222222222"
        "22222222222222222222222222222222222222222222222222"
        "22222222222222222222222222222222222222222222222222"

        "22222222222222222222222222222222222222222222222222"
        ",4>"
        , &r)->error);
}
